<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Train Tracker | Ben Rasich</title>
<meta name=keywords content><meta name=description content="
I happen to live right near Denver&rsquo;s Union Station, so my days are punctuated by the bells of Amtrak and Denver Transit trains just outside my window. I found myself consistently curious about which trains were coming and going and figured there had to be some sort of public data to get me those answers. In reality, things were a bit trickier to nail down."><meta name=author content="Ben"><link rel=canonical href=http://benrasich.com/posts/train-tracker/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=http://benrasich.com/assets/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://benrasich.com/assets/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://benrasich.com/assets/favicon-32x32.png><link rel=apple-touch-icon href=http://benrasich.com/assets/apple-touch-icon.png><link rel=mask-icon href=http://benrasich.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://benrasich.com/posts/train-tracker/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://benrasich.com/posts/train-tracker/"><meta property="og:site_name" content="Ben Rasich"><meta property="og:title" content="Train Tracker"><meta property="og:description" content="
I happen to live right near Denver’s Union Station, so my days are punctuated by the bells of Amtrak and Denver Transit trains just outside my window. I found myself consistently curious about which trains were coming and going and figured there had to be some sort of public data to get me those answers. In reality, things were a bit trickier to nail down."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-05T22:15:48+00:00"><meta property="article:modified_time" content="2025-01-05T22:15:48+00:00"><meta property="og:image" content="http://benrasich.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://benrasich.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Train Tracker"><meta name=twitter:description content="
I happen to live right near Denver&rsquo;s Union Station, so my days are punctuated by the bells of Amtrak and Denver Transit trains just outside my window. I found myself consistently curious about which trains were coming and going and figured there had to be some sort of public data to get me those answers. In reality, things were a bit trickier to nail down."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://benrasich.com/posts/"},{"@type":"ListItem","position":2,"name":"Train Tracker","item":"http://benrasich.com/posts/train-tracker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Train Tracker","name":"Train Tracker","description":"\nI happen to live right near Denver\u0026rsquo;s Union Station, so my days are punctuated by the bells of Amtrak and Denver Transit trains just outside my window. I found myself consistently curious about which trains were coming and going and figured there had to be some sort of public data to get me those answers. In reality, things were a bit trickier to nail down.\n","keywords":[],"articleBody":"\nI happen to live right near Denver’s Union Station, so my days are punctuated by the bells of Amtrak and Denver Transit trains just outside my window. I found myself consistently curious about which trains were coming and going and figured there had to be some sort of public data to get me those answers. In reality, things were a bit trickier to nail down.\nAmtrak Amtrak publishes current position and schedule of their trains on a map on their website, so clearly train data is available somewhere. Unfortunately, they don’t make it easy to find with a public API. Luckily, I’m not the first person to have this thought - Greg Walker did some sleuthing on how the map is populated and pubished his findings in a great blog post.\nEffectively, the train position data is encrypted when fetched by the map application, but the encryption keys are also readily recoverable by working back through some intentionally obfuscated logic and variable names. Even more bizarrely, all of this logic is thoroughly (and sarcastically) described in comments in the original javascript. Some highlights:\n//FAKE VARIABLES to throw off people hahahahaha // cw: xxx - Dwell time bug lurks here. // I crib this shamelessly from SO...because it is so useful!! And finally, the complete instructions for how to decrypt the train position data:\n/*MasterSegment is the length of the string at the end of the encrypted data that contains the secret key To decrypt - we do the following 1. Take masterSegment (88) length - from the right of the data - this has the private key 2. Everything from 0 to the end - master segment is the raw data - that needs to be decrypted 3. Decrypt the 88 characters using the public key - that will give you a pipe separated string of the private key (random guid from MDS) and a time stamp (to scramble it) 4. Now use the private key and decrypt the data stored from step 2. 5. Parse the decrypted data - and rejoice 6. KSUE -means key issue 7. __$$_jmd - the public key that we obtain Thanks to this post, I took some fairly trivial steps to rewrite the decryption in python. The Amtrak data is fairly comprehensive, reporting each train’s route, the stations on that route, and both scheduled, predicted, and actual times for arriving and departing those stations.\nFrom there, I can limit to just trains that come through Denver (currently just the California Zephyr from Chicago to San Francisco) and focus on the predicted and actual times of arrival and departure in Denver.\nRTD GTFS The Denver public transit agency, RTD, publishes schedule and vehicle position data via the General Transit Feed Specification (GTFS) standard. The story behind the standard is itself fairly interesting - before Google attempted to incorporate transit data into its maps, there was no standard for publishing timetables or positions. Google provided a standard specification for all transit agencies to adopt so that their timetables could be incorporated into Google Maps directions. This led to near-universal adoption across transit agencies, many of whom (including Denver) also make that data freely available in its raw form for analysis.\nI grabbed the real-time vehicle position data feed, which gives me the latitude and longitude of active vehicles by route. The tracks I can see serve 4 commuter rail lines that radiate out from downtown. Critically, all 4 routes converge on a roughly 700m long straight section of track as they pull into Union Station, so I can identify which trains are arriving, sitting in the station, or departing just by checking whether their positions cross a boundary 200m away from me between successive updates of their positions.\nThis all works great, but unfortunately the GTFS data from these lines is roughly 5 minutes delayed, so really this is only good for telling me which train arrived 5 minutes ago rather than just now as intended. This seems to be limited just to these lines - buses and light rail have positions update much more rapidly, so I’ll keep an eye on this delay and see if the data can be made more useful.\nTrain Tracker Pulling this all together, I ended up with a quick python script that can pull relevant arrival and departure times for the trains outside of my window so I can see in a glance what’s happening out there. To make it real, I display the results on an e-ink display powered by a Raspberry Pi Zero 2W, refreshing periodically via a simple cron job. Since the RTD data is so delayed, I actually cut that out for now to focus just on Amtrak until it gets a bit closer to real time position reporting.\nCode https://github.com/brasich/train-outside/tree/main\n","wordCount":"796","inLanguage":"en","image":"http://benrasich.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-01-05T22:15:48Z","dateModified":"2025-01-05T22:15:48Z","author":{"@type":"Person","name":"Ben"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://benrasich.com/posts/train-tracker/"},"publisher":{"@type":"Organization","name":"Ben Rasich","logo":{"@type":"ImageObject","url":"http://benrasich.com/assets/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://benrasich.com/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://benrasich.com/about title="About Me"><span>About Me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://benrasich.com/>Home</a>&nbsp;»&nbsp;<a href=http://benrasich.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Train Tracker</h1><div class=post-meta><span title='2025-01-05 22:15:48 +0000 UTC'>January 5, 2025</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Ben</div></header><div class=post-content><p><img alt="Denver Union Station Train Platform" loading=lazy src=/images/train-tracker/station.png></p><p>I happen to live right near Denver&rsquo;s Union Station, so my days are punctuated by the bells of Amtrak and Denver Transit trains just outside my window. I found myself consistently curious about which trains were coming and going and figured there had to be some sort of public data to get me those answers. In reality, things were a bit trickier to nail down.</p><h1 id=amtrak>Amtrak<a hidden class=anchor aria-hidden=true href=#amtrak>#</a></h1><p><img alt="Amtrak Train Map" loading=lazy src=/images/train-tracker/amtrak-map.png></p><p>Amtrak publishes current position and schedule of their trains on a <a href=https://www.amtrak.com/track-your-train.html>map on their website</a>, so clearly train data is available somewhere. Unfortunately, they don&rsquo;t make it easy to find with a public API. Luckily, I&rsquo;m not the first person to have this thought - Greg Walker did some sleuthing on how the map is populated and pubished his findings in <a href=https://mgwalker.github.io/blog/amtrak-api/>a great blog post</a>.</p><p>Effectively, the train position data is encrypted when fetched by the map application, but the encryption keys are also readily recoverable by working back through some intentionally obfuscated logic and variable names. Even more bizarrely, all of this logic is thoroughly (and sarcastically) described in comments in the original javascript. Some highlights:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>//FAKE VARIABLES to throw off people hahahahaha
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// cw: xxx - Dwell time bug lurks here.
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// I crib this shamelessly from SO...because it is so useful!!
</span></span></span></code></pre></div><p>And finally, the complete instructions for how to decrypt the train position data:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>/*MasterSegment is the length of the string at the end of the encrypted data that contains the secret key</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>To</span> <span style=color:#a6e22e>decrypt</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>we</span> <span style=color:#66d9ef>do</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>following</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1.</span> <span style=color:#a6e22e>Take</span> <span style=color:#a6e22e>masterSegment</span> (<span style=color:#ae81ff>88</span>) <span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>from</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>right</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>-</span> <span style=color:#66d9ef>this</span> <span style=color:#a6e22e>has</span> <span style=color:#a6e22e>the</span> <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>key</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2.</span> <span style=color:#a6e22e>Everything</span> <span style=color:#a6e22e>from</span> <span style=color:#ae81ff>0</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>end</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>master</span> <span style=color:#a6e22e>segment</span> <span style=color:#a6e22e>is</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>raw</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>that</span> <span style=color:#a6e22e>needs</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>be</span> <span style=color:#a6e22e>decrypted</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3.</span> <span style=color:#a6e22e>Decrypt</span> <span style=color:#a6e22e>the</span> <span style=color:#ae81ff>88</span> <span style=color:#a6e22e>characters</span> <span style=color:#a6e22e>using</span> <span style=color:#a6e22e>the</span> <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>that</span> <span style=color:#a6e22e>will</span> <span style=color:#a6e22e>give</span> <span style=color:#a6e22e>you</span> <span style=color:#a6e22e>a</span> <span style=color:#a6e22e>pipe</span> <span style=color:#a6e22e>separated</span> <span style=color:#a6e22e>string</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>the</span> <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>key</span> (<span style=color:#a6e22e>random</span> <span style=color:#a6e22e>guid</span> <span style=color:#a6e22e>from</span> <span style=color:#a6e22e>MDS</span>) <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>a</span> <span style=color:#a6e22e>time</span> <span style=color:#a6e22e>stamp</span> (<span style=color:#a6e22e>to</span> <span style=color:#a6e22e>scramble</span> <span style=color:#a6e22e>it</span>)
</span></span><span style=display:flex><span><span style=color:#ae81ff>4.</span> <span style=color:#a6e22e>Now</span> <span style=color:#a6e22e>use</span> <span style=color:#a6e22e>the</span> <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>key</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>decrypt</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>data</span> <span style=color:#a6e22e>stored</span> <span style=color:#a6e22e>from</span> <span style=color:#a6e22e>step</span> <span style=color:#ae81ff>2.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5.</span> <span style=color:#a6e22e>Parse</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>decrypted</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>rejoice</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>6.</span> <span style=color:#a6e22e>KSUE</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>means</span> <span style=color:#a6e22e>key</span> <span style=color:#a6e22e>issue</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>7.</span> <span style=color:#a6e22e>__$$_jmd</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>the</span> <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>key</span> <span style=color:#a6e22e>that</span> <span style=color:#a6e22e>we</span> <span style=color:#a6e22e>obtain</span>
</span></span></code></pre></div><p>Thanks to this post, I took some fairly trivial steps to rewrite the decryption in python. The Amtrak data is fairly comprehensive, reporting each train&rsquo;s route, the stations on that route, and both scheduled, predicted, and actual times for arriving and departing those stations.</p><p>From there, I can limit to just trains that come through Denver (currently just the California Zephyr from Chicago to San Francisco) and focus on the predicted and actual times of arrival and departure in Denver.</p><h1 id=rtd-gtfs>RTD GTFS<a hidden class=anchor aria-hidden=true href=#rtd-gtfs>#</a></h1><p>The Denver public transit agency, RTD, publishes <a href=https://www.rtd-denver.com/open-records/open-spatial-information/gtfs>schedule and vehicle position data</a> via the General Transit Feed Specification (GTFS) standard. The story behind the standard is itself fairly interesting - before Google attempted to incorporate transit data into its maps, there was no standard for publishing timetables or positions. Google provided a standard specification for all transit agencies to adopt so that their timetables could be incorporated into Google Maps directions. This led to near-universal adoption across transit agencies, many of whom (including Denver) also make that data freely available in its raw form for analysis.</p><p>I grabbed the real-time vehicle position data feed, which gives me the latitude and longitude of active vehicles by route. The tracks I can see serve 4 commuter rail lines that radiate out from downtown. Critically, all 4 routes converge on a roughly 700m long straight section of track as they pull into Union Station, so I can identify which trains are arriving, sitting in the station, or departing just by checking whether their positions cross a boundary 200m away from me between successive updates of their positions.</p><p>This all works great, but unfortunately the GTFS data from these lines is roughly 5 minutes delayed, so really this is only good for telling me which train arrived 5 minutes ago rather than just now as intended. This seems to be limited just to these lines - buses and light rail have positions update much more rapidly, so I&rsquo;ll keep an eye on this delay and see if the data can be made more useful.</p><h1 id=train-tracker>Train Tracker<a hidden class=anchor aria-hidden=true href=#train-tracker>#</a></h1><p>Pulling this all together, I ended up with a quick python script that can pull relevant arrival and departure times for the trains outside of my window so I can see in a glance what&rsquo;s happening out there. To make it real, I display the results on an e-ink display powered by a Raspberry Pi Zero 2W, refreshing periodically via a simple cron job. Since the RTD data is so delayed, I actually cut that out for now to focus just on Amtrak until it gets a bit closer to real time position reporting.</p><p><img alt="Train status display" loading=lazy src=/images/train-tracker/tracker.png></p><h3 id=code>Code<a hidden class=anchor aria-hidden=true href=#code>#</a></h3><p><a href=https://github.com/brasich/train-outside/tree/main>https://github.com/brasich/train-outside/tree/main</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=http://benrasich.com/posts/ut-msds-in-review/><span class=title>Next »</span><br><span>UT MSDS in Review</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://benrasich.com/>Ben Rasich</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>